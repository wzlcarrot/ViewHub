import{u as ve}from"./navActionStore-DKNJs-en.js";import{_ as H,a as X,m as T,b as pe,c as fe,d as ee}from"./index-V73uJnXy.js";import{a as U,u as P}from"./vue-router-ffDWPyKt.js";import{f as O,c as L,o as v,O as h,C as Y,r as k,m as F,h as W,W as ce,al as g,Q as C,a as e,u as $,P as q,I,K as D,V as ie,a6 as B,H as x,M as V,D as N,n as ae,l as re,S as le,z as oe,J as ne,R as se}from"./@vue-_Q8M3GyZ.js";import{H as ue}from"./hls.js-Cmhi5IOP.js";import{A as Z}from"./artplayer-BnYtXt6g.js";import{a as _e}from"./artplayer-plugin-danmuku-Dr19huTD.js";import"./pinia-CtRA5Bu2.js";import"./element-plus-Bescc1QT.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-DfuMZOfy.js";import"./@element-plus-B8yk6LGT.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BdefatKI.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-85_40PfK.js";import"./axios-NIGUFBhG.js";import"./vue-cookies-B4eaU0RH.js";import"./@fingerprintjs-BciRmnos.js";import"./tslib-BLN2B0TR.js";import"./vue-cropper-BrUi_TYK.js";import"./mitt-DJ65BbbF.js";import"./moment-C5S46NFB.js";const j={COMMENT_LIKE:{value:0,desc:"è¯„è®ºå–œæ¬¢ç‚¹èµ"},COMMENT_HATE:{value:1,desc:"è¯„è®ºè®¨åŒ"},VIDEO_LIKE:{value:2,desc:"è§†é¢‘ç‚¹èµ"},VIDEO_COLLECT:{value:3,desc:"è§†é¢‘æ”¶è—"},VIDEO_COIN:{value:4,desc:"è§†é¢‘æŠ•å¸"}},ye={__name:"Tag",props:{type:{type:Number}},setup(c){const{proxy:d}=O();U(),P();const u={0:{text:"ç½®é¡¶",color:"#FF6699"}};return(f,s)=>(v(),L("div",{class:"tag",style:Y({border:`1px solid ${u[c.type].color}`,color:`${u[c.type].color}`})},h(u[c.type].text),5))}},Ce=H(ye,[["__scopeId","data-v-b3d131f7"]]),he=[{name:"ç¬‘è„¸",emojiList:["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ¤£","ğŸ˜‚","ğŸ™‚","ğŸ™ƒ","ğŸ« ","ğŸ˜‰","ğŸ˜Š","ğŸ˜‡","ğŸ¥°","ğŸ˜","ğŸ¤©","ğŸ˜˜","ğŸ˜—","ğŸ˜š","ğŸ˜™","ğŸ¥²","ğŸ˜‹","ğŸ˜›","ğŸ˜œ","ğŸ¤ª","ğŸ˜","ğŸ¤‘","ğŸ¤—","ğŸ¤­","ğŸ«¢","ğŸ«£","ğŸ¤«","ğŸ¤”","ğŸ«¡","ğŸ¤","ğŸ¤¨","ğŸ˜","ğŸ˜‘","ğŸ˜¶","ğŸ«¥","ğŸ˜¶â€ğŸŒ«ï¸","ğŸ˜","ğŸ˜’","ğŸ™„","ğŸ˜¬","ğŸ˜®â€ğŸ’¨","ğŸ¤¥","ğŸ˜Œ","ğŸ˜”","ğŸ˜ª","ğŸ¤¤","ğŸ˜´","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ¥µ","ğŸ¥¶","ğŸ¥´","ğŸ˜µ","ğŸ˜µâ€ğŸ’«","ğŸ¤¯","ğŸ¤ ","ğŸ¥³","ğŸ¥¸","ğŸ˜","ğŸ¤“","ğŸ§","ğŸ˜•","ğŸ«¤","ğŸ˜Ÿ","ğŸ™","â˜¹ï¸","ğŸ˜®","ğŸ˜¯","ğŸ˜²","ğŸ˜³"]},{name:"äººç‰©",emojiList:["ğŸ‘‹","ğŸ¤š","ğŸ–ï¸","âœ‹","ğŸ––","ğŸ«±","ğŸ«²","ğŸ«³","ğŸ«´","ğŸ‘Œ","ğŸ¤Œ","ğŸ¤","âœŒï¸","ğŸ¤","ğŸ«°","ğŸ¤Ÿ","ğŸ¤˜","ğŸ¤™","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘†","ğŸ–•","ğŸ‘‡","â˜ï¸","ğŸ«µ","ğŸ‘","ğŸ‘","âœŠ","ğŸ‘Š","ğŸ¤›","ğŸ¤œ","ğŸ‘","ğŸ™Œ","ğŸ«¶","ğŸ‘","ğŸ¤²","ğŸ¤","ğŸ™","âœï¸","ğŸ’…","ğŸ¤³","ğŸ’ª","ğŸ¦¾","ğŸ¦¿","ğŸ¦µ","ğŸ¦¶","ğŸ‘‚","ğŸ¦»","ğŸ‘ƒ","ğŸ§ ","ğŸ«€","ğŸ«","ğŸ¦·","ğŸ¦´","ğŸ‘€","ğŸ‘ï¸","ğŸ‘…","ğŸ‘„","ğŸ«¦","ğŸ‘¶","ğŸ§’","ğŸ‘¦","ğŸ‘§","ğŸ§‘","ğŸ‘±","ğŸ‘¨","ğŸ§”","ğŸ§”â€â™‚ï¸","ğŸ§”â€â™€ï¸","ğŸ‘¨â€ğŸ¦°","ğŸ‘¨â€ğŸ¦±","ğŸ‘¨â€ğŸ¦³","ğŸ‘¨â€ğŸ¦²","ğŸ‘©","ğŸ‘©â€ğŸ¦°","ğŸ§‘â€ğŸ¦°","ğŸ‘©â€ğŸ¦±","ğŸ§‘â€ğŸ¦±","ğŸ‘©â€ğŸ¦³","ğŸ§‘â€ğŸ¦³"]},{name:"åŠ¨ç‰©",emojiList:["ğŸµ","ğŸ’","ğŸ¦","ğŸ¦§","ğŸ¶","ğŸ•","ğŸ¦®","ğŸ•","ğŸ©","ğŸº","ğŸ¦Š","ğŸ¦","ğŸ±","ğŸˆ","ğŸˆ","ğŸ¦","ğŸ¯","ğŸ…","ğŸ†","ğŸ´","ğŸ","ğŸ¦„","ğŸ¦“","ğŸ¦Œ","ğŸ¦¬","ğŸ®","ğŸ‚","ğŸƒ","ğŸ„","ğŸ·","ğŸ–","ğŸ—","ğŸ½","ğŸ","ğŸ‘","ğŸ","ğŸª","ğŸ«","ğŸ¦™","ğŸ¦’","ğŸ˜","ğŸ¦£","ğŸ¦","ğŸ¦›","ğŸ­","ğŸ","ğŸ€","ğŸ¹","ğŸ°","ğŸ‡","ğŸ¦«","ğŸ¦”","ğŸ¦‡","ğŸ»","ğŸ»","ğŸ¨","ğŸ¼","ğŸ¦¥","ğŸ¦¦","ğŸ¦¨","ğŸ¦˜","ğŸ¦¡","ğŸ¾","ğŸ¦ƒ","ğŸ”","ğŸ“","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ§","ğŸ¦…","ğŸ¦†","ğŸ¦¢","ğŸ¦‰","ğŸ¦¤","ğŸª¶","ğŸ¦©","ğŸ¦‚","ğŸ¦Ÿ"]}],ge={class:"send-panel"},Ie={class:"input-panel"},ke={key:0,class:"comment-image"},we={class:"op-panel"},$e={class:"op-btns"},Ae={class:"emoji-list"},Le=["onClick"],be={class:"send-btn"},Te={key:1,class:"no-send"},xe={__name:"VideoCommentSend",props:{sendType:{type:Number},showSend:{type:Boolean,default:!0}},setup(c){const{proxy:d}=O(),u=P();U();const f=X(),s=c,o=k({}),r=k(),l={content:[{required:!0,message:"è¯·è¾“å…¥è¯„è®ºå†…å®¹"}]},p=y=>{o.value.imgPath=y.file},w=y=>{o.value.imgPath=null},A=F("showReply"),i=async y=>{if(y.preventDefault(),!f.isLoggedIn){f.setLogin(!0);return}const m=s.sendType===0?{content:o.value.content,imgPath:o.value.imgPath}:Object.assign({},o.value);if(!m.content){d.Message.warning("è¯·è¾“å…¥è¯„è®º");return}if(m.videoId=u.params.videoId,m.imgPath){const E=await pe(m.imgPath,!0);m.imgPath=E}let b=await d.Request({url:d.Api.postComment,showLoading:!0,params:m});b&&(r.value.resetFields(),o.value={},d.Message.success("å‘å¸ƒæˆåŠŸ"),A(),T.emit("postCommentSuccess",b.data))},n=k(),t=k("ç¬‘è„¸"),a=y=>{o.value.content=o.value.content?o.value.content+y:y,n.value.hide()};return W(()=>{T.on("initCommentData",y=>{s.sendType!=0&&(o.value=Object.assign({},y))})}),ce(()=>{T.off("initCommentData")}),(y,m)=>{const b=g("Avatar"),E=g("el-input"),M=g("Cover"),z=g("el-form-item"),G=g("el-form"),te=g("el-tab-pane"),J=g("el-tabs"),Q=g("el-popover"),_=g("el-upload"),R=g("el-button");return v(),L("div",ge,[C(b,{avatar:$(f).isLoggedIn?$(f).userInfo.avatar:""},null,8,["avatar"]),e("div",Ie,[c.showSend?(v(),L(q,{key:0},[C(G,{model:o.value,rules:l,ref_key:"formDataRef",ref:r,onSubmit:m[1]||(m[1]=ie(()=>{},["prevent"]))},{default:I(()=>[C(z,{label:"",class:"input-area"},{default:I(()=>[C(E,{id:"inputPanel",ref:"inputRef",clearable:"",placeholder:o.value.nickName?"@"+o.value.nickName:"",modelValue:o.value.content,"onUpdate:modelValue":m[0]||(m[0]=S=>o.value.content=S),rows:1,type:"textarea",resize:"none","show-word-limit":!0,maxlength:500,autosize:{minRows:1,maxRows:5}},null,8,["placeholder","modelValue"]),o.value.imgPath?(v(),L("div",ke,[C(M,{fit:"cover",source:o.value.imgPath},null,8,["source"]),e("span",{class:"del iconfont icon-close",onClick:w})])):D("",!0)]),_:1})]),_:1},8,["model"]),e("div",we,[e("div",$e,[C(Q,{ref_key:"elPopoverRef",ref:n,width:500,trigger:"click","show-arrow":!1,offset:5,placement:"bottom-start"},{reference:I(()=>m[4]||(m[4]=[e("div",{class:"iconfont icon-emoji"},null,-1)])),default:I(()=>[C(J,{modelValue:t.value,"onUpdate:modelValue":m[2]||(m[2]=S=>t.value=S),onClick:m[3]||(m[3]=ie(()=>{},["stop"]))},{default:I(()=>[(v(!0),L(q,null,B($(he),S=>(v(),x(te,{label:S.name,name:S.name},{default:I(()=>[e("div",Ae,[(v(!0),L(q,null,B(S.emojiList,K=>(v(),L("div",{class:"emoji-item",onClick:oo=>a(K)},h(K),9,Le))),256))])]),_:2},1032,["label","name"]))),256))]),_:1},8,["modelValue"])]),_:1},512),C(_,{ref:"uploaderRef",multiple:!1,"show-file-list":!1,"http-request":p,accept:$(d).imageAccept},{default:I(()=>m[5]||(m[5]=[e("div",{class:"iconfont icon-image"},null,-1)])),_:1,__:[5]},8,["accept"])]),e("div",be,[C(R,{type:"primary",onMousedown:i},{default:I(()=>m[6]||(m[6]=[V("å‘å¸ƒ ",-1)])),_:1,__:[6]})])])],64)):(v(),L("div",Te,"UPä¸»å·²å…³é—­è¯„è®ºåŒº"))])])}}},de=H(xe,[["__scopeId","data-v-ab20523a"]]),Ve={class:"comment-item"},Ee={class:"comment-content-panel"},De={class:"nick-name-panel"},Se={class:"comment-message"},Re=["innerHTML"],Pe={key:0,class:"image-show"},Oe={class:"comment-op"},Me={class:"op-left"},Ne={class:"comment-time"},He={class:"reply-list"},Ue={__name:"VideoCommentItem",props:{data:{type:Object,default:{}},replyLevel:{type:Number,default:1}},setup(c){const{proxy:d}=O(),u=P();U();const f=X(),s=c,o=F("videoInfo"),r=F("showReply"),l=(n,t)=>{r(t==1?n.commentId:n.pCommentId),ae(()=>{const a={replyCommentId:n.commentId,nickName:n.nickName};T.emit("initCommentData",a)})},p=n=>{ee({videoId:u.params.videoId,actionType:j.COMMENT_LIKE.value,commentId:n.commentId},()=>{n.hateCountActive&&(n.hateCountActive=!1,n.hateCount--),n.likeCountActive?(n.likeCountActive=!1,n.likeCount--):(n.likeCount++,n.likeCountActive=!0)})},w=n=>{ee({videoId:u.params.videoId,actionType:j.COMMENT_HATE.value,commentId:n.commentId},()=>{n.likeCountActive&&(n.likeCountActive=!1,n.likeCount--),n.hateCountActive?(n.hateCountActive=!1,n.hateCount--):(n.hateCount++,n.hateCountActive=!0)})},A=()=>{d.Confirm({message:"ç¡®å®šè¦åˆ é™¤è¯„è®º",okfun:async()=>{await d.Request({url:d.Api.userDelComment,params:{commentId:s.data.commentId}})&&T.emit("delCommentCallback",{pCommentId:s.data.pCommentId,commentId:s.data.commentId})}})},i=()=>{d.Confirm({message:`ç¡®å®šè¦${s.data.topType==1?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"}å—ï¼Ÿ`,okfun:async()=>{await d.Request({url:s.data.topType==1?d.Api.userCancelTopComment:d.Api.userTopComment,params:{commentId:s.data.commentId}})&&T.emit("topCommentCallback")}})};return(n,t)=>{const a=g("router-link"),y=g("Cover"),m=g("el-dropdown-item"),b=g("el-dropdown-menu"),E=g("el-dropdown");return v(),L("div",Ve,[C(fe,{width:c.replyLevel==1?50:30,avatar:c.data.avatar,userId:c.data.userId},null,8,["width","avatar","userId"]),e("div",Ee,[e("div",De,[C(a,{to:`/user/${c.data.userId}`,class:"nick-name"},{default:I(()=>[V(h(c.data.nickName),1)]),_:1},8,["to"]),c.data.replyUserId?(v(),L(q,{key:0},[t[3]||(t[3]=e("div",{class:"reply-title"},"å›å¤",-1)),C(a,{to:`/user/${c.data.replyUserId}`,class:"reply-nick-name"},{default:I(()=>[V(" @"+h(c.data.replyNickName),1)]),_:1},8,["to"])],64)):D("",!0)]),e("div",Se,[c.data.topType==1?(v(),x(Ce,{key:0,type:0})):D("",!0),e("span",{innerHTML:$(d).Utils.resetHtmlContent(c.data.content)},null,8,Re)]),c.data.imgPath?(v(),L("div",Pe,[C(y,{source:c.data.imgPath+$(d).imageThumbnailSuffix,preview:!0,fit:"cover"},null,8,["source"])])):D("",!0),e("div",Oe,[e("div",Me,[e("div",Ne,h(c.data.postTime),1),e("div",{class:N(["iconfont icon-good",c.data.likeCountActive?"active":""]),onClick:t[0]||(t[0]=M=>p(c.data))},h(c.data.likeCount==0?"":c.data.likeCount),3),e("div",{class:N(["iconfont icon-no-good",c.data.hateCountActive?"active":""]),onClick:t[1]||(t[1]=M=>w(c.data))},h(c.data.hateCount==0?"":c.data.hateCount),3),e("div",{class:"reply-btn",onClick:t[2]||(t[2]=M=>l(c.data,c.replyLevel))}," å›å¤ ")]),c.data.userId==$(f).userInfo.userId||$(o).userId==$(f).userInfo.userId?(v(),x(E,{key:0},{dropdown:I(()=>[C(b,null,{default:I(()=>[$(o).userId==$(f).userInfo.userId&&c.data.pCommentId==0?(v(),x(m,{key:0,onClick:i},{default:I(()=>[V(h(c.data.topType==1?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"),1)]),_:1})):D("",!0),$(o).userId==$(f).userInfo.userId||c.data.userId==$(f).userInfo.userId?(v(),x(m,{key:1,onClick:A},{default:I(()=>t[4]||(t[4]=[V("åˆ é™¤",-1)])),_:1,__:[4]})):D("",!0)]),_:1})]),default:I(()=>[t[5]||(t[5]=e("span",{class:"op-right iconfont icon-more"},null,-1))]),_:1,__:[5]})):D("",!0)]),e("div",He,[(v(!0),L(q,null,B(c.data.children,M=>(v(),x(me,{data:M,replyLevel:2},null,8,["data"]))),256))]),c.replyLevel==1&&c.data.showReply?(v(),x(de,{key:1,sendType:1})):D("",!0)])])}}},me=H(Ue,[["__scopeId","data-v-420b90c0"]]),qe={class:"comment-panel"},Fe={class:"comment-title"},je={class:"title"},Ke={class:"comment-count"},Be={class:"comment-content-panel"},We={class:"comment-list"},ze={__name:"VideoComment",setup(c){const{proxy:d}=O(),u=P();U(),X();const f=F("videoInfo"),s=re(()=>f.value.interaction==null||f.value.interaction.indexOf("1")==-1);oe("showReply",n=>{l.value.list.forEach(t=>{t.commentId!=n?t.showReply=!1:t.showReply=!0})});const r=k(!1),l=k({}),p=k(0),w=n=>{p.value=n,A()},A=async()=>{if(!s.value)return;r.value=!0;let n=await d.Request({url:d.Api.loadComment,params:{videoId:u.params.videoId,pageNo:l.value.pageNo,orderType:p.value}});if(r.value=!1,!n)return;const t={};n.data.userActionList.forEach(b=>{t[b.commentId]=b});const y=n.data.commentData;y.list.forEach(b=>{i(t,b),b.children&&b.children.forEach(E=>{i(t,E)})});const m=l.value.list;l.value=Object.assign({},y),y.pageNo>1&&(l.value.list=m.concat(y.list))};A();const i=(n,t)=>{const a=n[t.commentId];a&&(j.COMMENT_LIKE.value==a.actionType?t.likeCountActive=!0:j.COMMENT_HATE.value==a.actionType&&(t.hateCountActive=!0))};return W(()=>{T.on("postCommentSuccess",n=>{if(n.pCommentId===0){l.value.list.unshift(n),l.value.totalCount?l.value.totalCount++:l.value.totalCount=1;return}else{const t=l.value.list.find(a=>a.commentId==n.pCommentId);if(!t)return;t.children||(t.children=[]),t.children.push(n)}}),T.on("delCommentCallback",({pCommentId:n,commentId:t})=>{if(n==0)l.value.list=l.value.list.filter(a=>a.commentId!=t),l.value.totalCount--;else{const a=l.value.list.find(y=>y.commentId==n);a.children=a.children.filter(y=>y.commentId!=t)}}),T.on("topCommentCallback",()=>{A()})}),le(()=>{T.off("postCommentSuccess"),T.off("delCommentCallback"),T.off("topCommentCallback")}),(n,t)=>{const a=g("el-divider"),y=g("DataLoadMoreList");return v(),L("div",qe,[e("div",Fe,[e("div",je,[t[2]||(t[2]=V(" è¯„è®º",-1)),e("span",Ke,h(l.value.totalCount),1)]),e("div",{class:N(["order-type-item",p.value==0?"active":""]),onClick:t[0]||(t[0]=m=>w(0))}," æœ€çƒ­ ",2),C(a,{direction:"vertical"}),e("div",{class:N(["order-type-item",p.value==1?"active":""]),onClick:t[1]||(t[1]=m=>w(1))}," æœ€æ–° ",2)]),e("div",Be,[C(de,{sendType:0,showSend:s.value},null,8,["showSend"]),e("div",We,[C(y,{dataSource:l.value,loading:r.value,onLoadData:A,layoutType:"list",loadEndMsg:"æ²¡æœ‰æ›´å¤šè¯„è®º"},{default:I(({data:m})=>[C(me,{data:m},null,8,["data"])]),_:1},8,["dataSource","loading"])])])])}}},Ye=H(ze,[["__scopeId","data-v-25633d7a"]]),Xe={class:"summary-panel"},Ge=["innerHTML"],Je={class:"tag-list"},Qe={__name:"VideoSummary",setup(c){const{proxy:d}=O();P(),U();const u=F("videoInfo"),f=k(!1),s=k(!1),o=()=>{s.value=!s.value};return W(()=>{document.querySelector("#summary-inner").clientHeight>90?(s.value=!1,f.value=!0):(s.value=!0,f.value=!1)}),(r,l)=>{const p=g("router-link");return v(),L("div",Xe,[e("div",{class:"summary",style:Y({height:s.value?"auto":"90px"})},[e("div",{class:"summary-inner",id:"summary-inner",innerHTML:$(u).introduction},null,8,Ge)],4),ne(e("div",{class:"expand-btn",onClick:o},h(s.value?"æ”¶èµ·":"å±•å¼€æ›´å¤š"),513),[[se,f.value]]),e("div",Je,[(v(!0),L(q,null,B($(u).tags,w=>(v(),x(p,{to:`/search?keyword=${w}`,class:"tag-item",target:"_blank"},{default:I(()=>[V(h(w),1)]),_:2},1032,["to"]))),256))])])}}},Ze=H(Qe,[["__scopeId","data-v-6605b1c9"]]),et={class:"cion-panel"},tt={class:"title-info"},ot={class:"coin-count"},nt={class:"coin-list"},st=["src"],at=["src"],lt={class:"sub-btn"},it={__name:"VideoCoin",setup(c,{expose:d}){const{proxy:u}=O(),f=P(),s=k({show:!1,title:"æŠ•å¸",buttons:[]}),o=k(1),r=A=>{o.value=A},l=F("videoInfo"),p=()=>{ee({videoId:f.params.videoId,actionType:j.VIDEO_COIN.value,actionCount:o.value},()=>{l.value.coinCountActive=!0,l.value.coinCount=l.value.coinCount+o.value,s.value.show=!1,u.Message.success("æŠ•å¸æˆåŠŸ")})};return d({show:()=>{s.value.show=!0,o.value=1}}),(A,i)=>{const n=g("el-button"),t=g("Dialog");return v(),x(t,{show:s.value.show,buttons:s.value.buttons,width:"400px",showCancel:!1,top:200,onClose:i[2]||(i[2]=a=>s.value.show=!1)},{default:I(()=>[e("div",et,[e("div",tt,[i[3]||(i[3]=V("ç»™UPä¸»æŠ•ä¸Š ",-1)),e("span",ot,h(o.value),1),i[4]||(i[4]=V(" æšç¡¬å¸",-1))]),e("div",nt,[e("div",{class:N(["coin-item",o.value==1?"acitve":""]),onClick:i[0]||(i[0]=a=>r(1))},[e("img",{src:$(u).Utils.getLocalImage("coin1.png")},null,8,st),i[5]||(i[5]=e("div",{class:"coin-count-inner"},"1ç¡¬å¸",-1))],2),e("div",{class:N(["coin-item",o.value==2?"acitve":""]),onClick:i[1]||(i[1]=a=>r(2))},[e("img",{src:$(u).Utils.getLocalImage("coin2.png")},null,8,at),i[6]||(i[6]=e("div",{class:"coin-count-inner"},"2ç¡¬å¸",-1))],2)]),e("div",lt,[C(n,{type:"primary",onClick:p},{default:I(()=>i[7]||(i[7]=[V("ç¡®å®š",-1)])),_:1,__:[7]})])])]),_:1},8,["show","buttons"])}}},ut=H(it,[["__scopeId","data-v-e1d0035a"]]),ct={class:"action-panel"},rt={__name:"VideoAction",setup(c){const d=X(),{proxy:u}=O(),f=P();U();const s=F("videoInfo"),o=p=>{if(!d.isLoggedIn){d.setLogin(!0);return}ee({videoId:f.params.videoId,actionType:j[p].value},()=>{p=="VIDEO_LIKE"?s.value.likeCountActive?(s.value.likeCountActive=!1,s.value.likeCount--):(s.value.likeCountActive=!0,s.value.likeCount++):p=="VIDEO_COLLECT"&&(s.value.collectCountActive?(s.value.collectCountActive=!1,s.value.collectCount--):(s.value.collectCountActive=!0,s.value.collectCount++))})},r=k(),l=()=>{if(!d.isLoggedIn){d.setLogin(!0);return}if(s.value.coinCountActive){u.Message.warning("å¯¹æœ¬ç¨¿ä»¶çš„æŠ•å¸æšæ•°å·²ç”¨å®Œ");return}r.value.show()};return(p,w)=>(v(),L(q,null,[e("div",ct,[e("div",{class:N(["iconfont icon-like-solid",$(s).likeCountActive?"active":""]),onClick:w[0]||(w[0]=A=>o("VIDEO_LIKE"))},h($(s).likeCount),3),e("div",{class:N(["iconfont icon-toubi",$(s).coinCountActive?"active":""]),onClick:w[1]||(w[1]=A=>l())},h($(s).coinCount),3),e("div",{class:N(["iconfont icon-collection-solid",$(s).collectCountActive?"active":""]),onClick:w[2]||(w[2]=A=>o("VIDEO_COLLECT"))},h($(s).collectCount),3)]),C(ut,{ref_key:"videoCoinRef",ref:r},null,512)],64))}},dt=H(rt,[["__scopeId","data-v-36063207"]]),mt={class:"danmu-panel"},vt={class:"danmu-list"},pt=["onClick"],ft={class:"time"},_t=["title"],yt={class:"send-time"},Ct={__name:"VideoDanmu",setup(c){const{proxy:d}=O();P(),U();const u=d.playerHeight,f=k([]);W(()=>{T.on("loadDanmu",r=>{r.sort(function(l,p){return l.time-p.time}),f.value=r})}),le(()=>{T.off("loadDanmu")});const s=k({}),o=r=>{s.value=r};return(r,l)=>{const p=g("NoData"),w=g("el-scrollbar"),A=g("Collapse");return v(),L("div",mt,[C(A,null,{title:I(()=>l[0]||(l[0]=[e("div",{class:"danmu-panel-title"},[e("div",null,"å¼¹å¹•åˆ—è¡¨"),e("div",{class:"iconfont icon-more"})],-1)])),default:I(()=>[e("div",vt,[l[1]||(l[1]=e("div",{class:"danmu-title danmu-item"},[e("div",{class:"time"},"æ—¶é—´"),e("div",{class:"content"},"å¼¹å¹•å†…å®¹"),e("div",{class:"send-time"},"å‘é€æ—¶é—´")],-1)),C(w,{height:"400px","max-height":$(u)-60},{default:I(()=>[(v(!0),L(q,null,B(f.value,i=>(v(),L("div",{class:N(["danmu-item",i.danmuId==s.value.danmuId?"active":""]),onClick:n=>o(i)},[e("div",ft,h($(d).Utils.convertSecondsToHMS(Math.round(i.time))),1),e("div",{class:"content",title:i.text},h(i.text),9,_t),e("div",yt,h(i.postTime),1)],10,pt))),256)),f.value.length==0?(v(),x(p,{key:0,msg:"æš‚æ— å¼¹å¹•"})):D("",!0)]),_:1},8,["max-height"])])]),_:1})])}}},ht=H(Ct,[["__scopeId","data-v-6868f1c1"]]),gt={key:0,class:"video-panel"},It={class:"video-panel-title"},kt={class:"title"},wt={class:"video-count"},$t=["onClick"],At={key:0,class:"playing"},Lt=["title"],bt={class:"duration"},Tt={__name:"VideoPList",emits:["selectVideoFile"],setup(c,{emit:d}){const{proxy:u}=O(),f=P(),s=U(),o=k(!0),r=k(f.query.p?Number.parseInt(f.query.p):1),l=k([]);(async()=>{let i=await u.Request({url:u.Api.loadVideoPList,params:{videoId:f.params.videoId}});i&&(l.value=i.data,A())})();const w=i=>{r.value=i,s.push({path:f.path,query:{p:i}}),A()},A=()=>{T.emit("changeP",l.value[r.value-1].fileId)};return W(()=>{T.on("playEnd",()=>{o.value&&l.value.length>1&&r.value<l.value.length&&w(r.value+1)})}),le(()=>{T.off("playEnd")}),(i,n)=>{const t=g("el-switch"),a=g("el-scrollbar");return l.value.length>1?(v(),L("div",gt,[e("div",It,[e("div",kt,[n[1]||(n[1]=V(" è§†é¢‘é€‰é›†",-1)),e("span",wt,"("+h(r.value)+"/"+h(l.value.length)+")",1),n[2]||(n[2]=e("span",{class:"iconfont icon-list"},null,-1))]),C(t,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=y=>o.value=y),"inactive-text":"è‡ªåŠ¨è¿æ’­"},null,8,["modelValue"])]),C(a,{"max-height":600,class:"video-list"},{default:I(()=>[(v(!0),L(q,null,B(l.value,(y,m)=>(v(),L("div",{class:N(["video-item",m==r.value-1?"active":""]),onClick:b=>w(m+1)},[m==r.value-1?(v(),L("div",At)):D("",!0),e("div",{class:"title",title:y.title}," P"+h(m+1)+" "+h(y.fileName),9,Lt),e("div",bt,h($(u).Utils.convertSecondsToHMS(y.duration)),1)],10,$t))),256))]),_:1})])):D("",!0)}}},xt=H(Tt,[["__scopeId","data-v-b2a2c112"]]),Vt={__name:"VideoRecommend",setup(c){const{proxy:d}=O();P(),U();const u=k([]),f=F("videoInfo");return(async()=>{let o=await d.Request({url:d.Api.getVideoRecommend,params:{keyword:f.value.videoName,videoId:f.value.videoId}});o&&(u.value=o.data)})(),(o,r)=>{const l=g("VideoItem");return v(!0),L(q,null,B(u.value,p=>(v(),x(l,{data:p,layoutType:1,marginTop:20},null,8,["data"]))),256)}}},Et={class:"player-panel"},Dt={class:"danmu-panel"},St={class:"watcher"},Rt={id:"danmu"},Pt={class:"close-danmu"},Ot={id:"play"},Mt=["src"],Nt={__name:"Player",props:{fileId:{type:String,default:""}},emits:["changeWideScreen"],setup(c,{emit:d}){const{proxy:u}=O();U();const f=P(),s=X(),o=k();u.Api.getVideoResource;let r=null;const l=()=>{Z.CONTEXTMENU=!1,Z.AUTO_PLAYBACK_MAX=20,Z.AUTO_PLAYBACK_MIN=10,r=new Z({container:o.value,url:"",type:"m3u8",customType:{m3u8:function(_,R,S){if(ue.isSupported()){S.hls&&S.hls.destroy();const K=new ue;K.loadSource(R),K.attachMedia(_),S.hls=K,S.on("destroy",()=>K.destroy())}else _.canPlayType("application/vnd.apple.mpegurl")?_.src=R:S.notice.show="æµè§ˆå™¨ä¸æ”¯æŒè¯¥æ’­æ”¾å™¨"}},theme:"#23ade5",volume:.7,autoplay:!0,autoMini:!1,fullscreen:!0,fullscreenWeb:!0,setting:!0,pip:!0,playbackRate:!0,flip:!0,aspectRatio:!0,screenshot:!0,autoPlayback:!0,icons:{state:document.querySelector("#play")},controls:[{name:"wide-screen",position:"right",html:'<span class="iconfont icon-wide-screen"></span>',tooltip:"å®½å±æ¨¡å¼",style:{color:"#fff",display:"flex"},click:function(..._){A()}},{name:"narrow-screen",position:"right",html:'<span class="iconfont icon-narrow-screen"></span>',tooltip:"é€€å‡ºå®½å±",style:{color:"#fff",display:"none"},click:function(..._){A()}}],plugins:[_e({mount:document.querySelector("#danmu"),theme:"light",emitter:!0,danmuku:function(){return new Promise(async _=>{const R=await a();return _(R)})},beforeEmit:async _=>{let R=await n(_);return a(),R?(T.emit("danmSend"),u.Message.success("å‘å¸ƒæˆåŠŸ"),!0):!1}})]}),r.on("hover",_=>{let R="none";_&&(R="flex"),r.template.$bottom.style.display=R}),r.on("video:ended",_=>{T.emit("playEnd")})},p=d,w=k(!1),A=()=>{w.value=!w.value,w.value?(r.controls["wide-screen"].style.display="none",r.controls["narrow-screen"].style.display="flex"):(r.controls["wide-screen"].style.display="flex",r.controls["narrow-screen"].style.display="none"),p("changeWideScreen",w.value)},i=k(),n=_=>{if(!s.isLoggedIn){s.setLogin(!0);return}return _.fileId=i.value,_.videoId=f.params.videoId,_.time=Math.round(_.time),u.Request({url:u.Api.postDanmu,params:_})},t=k(0),a=async()=>{if(!i.value)return[];let _=await u.Request({url:u.Api.loadDanmu,params:{fileId:i.value,videoId:f.params.videoId}});return _?(T.emit("loadDanmu",_.data),t.value=_.data.length,_.data):[]},y=k(500),m=F("playerHeight");W(()=>{ae(()=>{l();const _=Math.round((o.value.clientWidth-8)*.5625);y.value=_,m(_)}),T.on("changeP",_=>{i.value=_,z(),r.switch=`${u.Api.getVideoResource}/${_}/`,r.plugins.artplayerPluginDanmuku.load()}),E()}),ce(()=>{r&&r.destroy(!1),T.off("changeP"),G()});let b=k(null);const E=()=>{b.value=setInterval(()=>{z()},5e3)},M=k(1),z=async()=>{if(!i.value)return;let _=await u.Request({url:u.Api.reportVideoPlayOnline,params:{fileId:i.value,deviceId:s.deviceId},showError:!1});_&&(M.value=_.data)},G=()=>{b.value!==null&&(clearInterval(b.value),b.value=null)},te=_=>{_.target&&(_.target.style.display="none"),_.target.onerror=null},J=F("videoInfo"),Q=re(()=>J.value.interaction==null||J.value.interaction.indexOf("0")==-1);return(_,R)=>(v(),L("div",Et,[e("div",{ref_key:"playerRef",ref:o,class:"player-style",style:Y({height:y.value+"px"})},null,4),e("div",Dt,[e("div",St,h(M.value)+" äººæ­£åœ¨çœ‹ï¼Œå·²è£…å¡« "+h(t.value)+" æ¡å¼¹å¹• ",1),ne(e("div",Rt,null,512),[[se,Q.value]]),ne(e("div",Pt,"å·²å…³é—­å¼¹å¹•",512),[[se,!Q.value]])]),e("div",Ot,[e("img",{src:$(u).Utils.getLocalImage("play.png"),onError:te,alt:"æ’­æ”¾æŒ‰é’®"},null,40,Mt)])]))}},Ht=H(Nt,[["__scopeId","data-v-618f9512"]]),Ut={class:"video-detail"},qt={class:"video-header"},Ft={class:"video-title"},jt={class:"title"},Kt={class:"video-info"},Bt={class:"iconfont icon-play2"},Wt={class:"iconfont icon-danmu"},zt={class:"iconfont"},Yt={class:"video-user-info"},Xt={class:"user-info"},Gt={class:"introduction"},Jt={class:"op-btns"},Qt={class:"focus-btn"},Zt={class:"video-body"},eo={class:"video-left"},to={__name:"VideoDetail",setup(c){const d=ve(),{proxy:u}=O();U();const f=P(),s=X(),o=k({}),r=async t=>{let a=await u.Request({url:u.Api.uHomeGetUsesrInfo,params:{userId:t}});a&&(o.value=a.data)},l=async t=>{if(!s.isLoggedIn){s.setLogin(!0);return}await u.Request({url:t==1?u.Api.uHomeFocus:u.Api.uHomeCancelFocus,showLoading:!0,params:{focusUserId:o.value.userId}})&&(t==1?(o.value.haveFocus=!0,o.value.fansCount++):(o.value.fansCount--,o.value.haveFocus=!1))},p=k({});(async()=>{let t=await u.Request({url:u.Api.getVideoInfo,params:{videoId:f.params.videoId}});if(!t)return;r(t.data.videoInfo.userId);const a=t.data.videoInfo;let y=a.introduction||"";y=u.Utils.resetHtmlContent(a.introduction);const m=a.tags?a.tags.split(","):[];a.introduction=y,a.tags=m,p.value=a,t.data.userActionList.forEach(E=>{E.actionType==j.VIDEO_LIKE.value?p.value.likeCountActive=!0:E.actionType==j.VIDEO_COLLECT.value?p.value.collectCountActive=!0:E.actionType==j.VIDEO_COIN.value&&(p.value.coinCountActive=!0)})})(),oe("videoInfo",p);const A=k(0);oe("playerHeight",t=>{A.value=t});const i=k(!1),n=t=>{i.value=t};return W(()=>{ae(()=>{d.setShowHeader(!1),d.setFixedHeader(!0),d.setFixedCategory(!1),d.setShowCategory(!1),d.setForceFixedHeader(!0)}),T.on("danmSend",()=>{p.value.danmuCount++})}),(t,a)=>{const y=g("Avatar"),m=g("router-link"),b=g("el-button"),E=g("el-dropdown-item"),M=g("el-dropdown-menu"),z=g("el-dropdown");return v(),L("div",Ut,[e("div",qt,[e("div",Ft,[e("div",jt,h(p.value.videoName),1),e("div",Kt,[e("div",Bt,h(p.value.playCount),1),e("div",Wt,h(p.value.danmuCount),1),e("div",zt,h(p.value.createTime),1)])]),e("div",Yt,[C(y,{userId:o.value.userId,avatar:o.value.avatar},null,8,["userId","avatar"]),e("div",Xt,[C(m,{class:"nick-name",to:`/user/${o.value.userId}`,target:"_blank"},{default:I(()=>[V(h(o.value.nickName),1)]),_:1},8,["to"]),e("div",Gt,h(o.value.personIntroduction||"è¿™ä¸ªäººæ²¡æœ‰å¡«ç®€ä»‹å•Š~~~"),1),e("div",Jt,[C(m,{class:"btn-go-home",to:`/user/${o.value.userId}`,target:"_blank"},{default:I(()=>a[2]||(a[2]=[V("è®¿é—®ä¸»é¡µ",-1)])),_:1,__:[2]},8,["to"]),e("div",Qt,[o.value.haveFocus?(v(),x(z,{key:0},{dropdown:I(()=>[C(M,null,{default:I(()=>[C(E,{onClick:a[0]||(a[0]=G=>l(-1))},{default:I(()=>a[4]||(a[4]=[V("å–æ¶ˆå…³æ³¨",-1)])),_:1,__:[4]})]),_:1})]),default:I(()=>[C(b,{class:"btn",type:"info",style:{width:"100%"}},{default:I(()=>[a[3]||(a[3]=e("span",{class:"iconfont icon-list"},null,-1)),V("å·²å…³æ³¨ "+h(o.value.fansCount),1)]),_:1,__:[3]})]),_:1})):(v(),x(b,{key:1,class:"btn",type:"primary",onClick:a[1]||(a[1]=G=>l(1))},{default:I(()=>[V("å…³æ³¨ "+h(o.value.fansCount),1)]),_:1}))])])])])]),e("div",Zt,[e("div",eo,[e("div",{class:"video-panel",style:Y({position:i.value?"absolute":"static"})},[C(Ht,{ref:"playerRef",onChangeWideScreen:n},null,512)],4),e("div",{style:Y({"margin-top":i.value?A.value+56+"px":"0px"})},[C(dt),Object.keys(p.value).length>0?(v(),x(Ze,{key:0})):D("",!0),Object.keys(p.value).length>0?(v(),x(Ye,{key:1})):D("",!0)],4)]),e("div",{class:"video-right",style:Y({"margin-top":i.value?A.value+70+"px":"0px"})},[C(ht),C(xt),Object.keys(p.value).length>0?(v(),x(Vt,{key:0})):D("",!0)],4)])])}}},Vo=H(to,[["__scopeId","data-v-06da9c16"]]);export{Vo as default};
