import{f as q,r as y,al as v,c as f,o as c,Q as l,I as r,a as s,P as M,a6 as B,K as L,u as p,z as T,H as F,V as G,M as R,O as g,n as P,l as Q,C as z,D as W,a4 as J}from"./@vue-_Q8M3GyZ.js";import{a as S,u as E}from"./vue-router-ffDWPyKt.js";import{_ as Y,a as K,b as X}from"./index-V73uJnXy.js";import{_ as Z}from"./Account-oZxBa5bd.js";import{L as ee}from"./LayoutHeader-Dl1hBvXf.js";import"./pinia-CtRA5Bu2.js";import"./element-plus-Bescc1QT.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-DfuMZOfy.js";import"./@element-plus-B8yk6LGT.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BdefatKI.js";import"./artplayer-BnYtXt6g.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-85_40PfK.js";import"./axios-NIGUFBhG.js";import"./vue-cookies-B4eaU0RH.js";import"./@fingerprintjs-BciRmnos.js";import"./tslib-BLN2B0TR.js";import"./vue-cropper-BrUi_TYK.js";import"./mitt-DJ65BbbF.js";import"./moment-C5S46NFB.js";import"./js-md5-Bbdx8amY.js";const oe={class:"theme-body"},te={class:"theme-gird-list"},se=["onClick"],ae=["src"],le={key:0,class:"checked iconfont icon-checked"},ne=10,ue={__name:"UserHomeTheme",emits:["changeTheme"],setup(A,{expose:m,emit:V}){const{proxy:I}=q();S();const n=y(!1),o=y(0),C=V,b=async _=>{o.value=_,await I.Request({url:I.Api.saveTheme,params:{theme:_}})&&(n.value=!1,C("changeTheme",_))};return m({show:_=>{n.value=!0,o.value=_}}),(_,x)=>{const h=v("el-scrollbar"),t=v("el-drawer");return c(),f("div",oe,[l(t,{"lock-scroll":"",modelValue:n.value,"onUpdate:modelValue":x[0]||(x[0]=i=>n.value=i),title:"选择背景",direction:"btt",size:"45%"},{default:r(()=>[l(h,{height:"100%"},{default:r(()=>[s("div",te,[(c(),f(M,null,B(ne,i=>s("div",{class:"grid-item",onClick:w=>b(i)},[s("img",{src:p(I).Utils.getLocalImage("uhome-bg/"+i+".png")},null,8,ae),o.value==i?(c(),f("div",le)):L("",!0)],8,se)),64))])]),_:1})]),_:1},8,["modelValue"])])}}},re=Y(ue,[["__scopeId","data-v-06b104d1"]]),ie={__name:"UserInfoEdit",emits:["reload"],setup(A,{expose:m,emit:V}){const{proxy:I}=q();E(),S(),K();const n=y({show:!1,title:"修改用户信息",buttons:[{type:"primary",text:"确定",click:h=>{x()}}]});T("cutImageCallback",({coverImage:h})=>{o.value.avatar=h});const o=y({}),C=y(),b={avatar:[{required:!0,message:"请上传头像"}],nickName:[{required:!0,message:"请输入昵称"}],sex:[{required:!0,message:"请选择性别"}]};m({show:h=>{n.value.show=!0,P(()=>{C.value.resetFields(),o.value=Object.assign({},h)})}});const _=V,x=()=>{C.value.validate(async h=>{if(!h)return;let t={};if(Object.assign(t,o.value),t.avatar instanceof File){const w=await X(t.avatar);if(!w)return;t.avatar=w}await I.Request({url:I.Api.uHomeUpdateUserInfo,params:t})&&(n.value.show=!1,I.Message.success("修改成功"),_("reload"))})};return(h,t)=>{const i=v("el-form-item"),w=v("ImageCoverSelect"),U=v("el-input"),N=v("el-radio"),D=v("el-radio-group"),H=v("el-date-picker"),d=v("el-form"),e=v("Dialog");return c(),F(e,{show:n.value.show,title:n.value.title,buttons:n.value.buttons,width:"500px",onClose:t[7]||(t[7]=u=>n.value.show=!1)},{default:r(()=>[l(d,{model:o.value,rules:b,ref_key:"formDataRef",ref:C,"label-width":"80px",onSubmit:t[6]||(t[6]=G(()=>{},["prevent"]))},{default:r(()=>[l(i,{label:"UID",prop:""},{default:r(()=>[R(g(o.value.userId),1)]),_:1}),l(i,{label:"头像",prop:"avatar"},{default:r(()=>[l(w,{coverWidth:150,cutWidth:150,scale:1,coverImage:o.value.avatar},null,8,["coverImage"])]),_:1}),l(i,{label:"昵称",prop:"nickName"},{default:r(()=>[l(U,{clearable:"",placeholder:"昵称",modelValue:o.value.nickName,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.nickName=u),maxlength:20,"show-word-limit":""},null,8,["modelValue"])]),_:1}),l(i,{label:"性别",prop:"sex"},{default:r(()=>[l(D,{modelValue:o.value.sex,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.sex=u)},{default:r(()=>[l(N,{value:0},{default:r(()=>t[8]||(t[8]=[R("女",-1)])),_:1,__:[8]}),l(N,{value:1},{default:r(()=>t[9]||(t[9]=[R("男",-1)])),_:1,__:[9]}),l(N,{value:2},{default:r(()=>t[10]||(t[10]=[R("保密",-1)])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"出生日期",prop:"birthday"},{default:r(()=>[l(H,{modelValue:o.value.birthday,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.birthday=u),type:"date",placeholder:"请选择出生日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(i,{label:"学校",prop:"school"},{default:r(()=>[l(U,{clearable:"",placeholder:"学校信息",modelValue:o.value.school,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.school=u),maxlength:150,"show-word-limit":""},null,8,["modelValue"])]),_:1}),l(i,{label:"简介",prop:"personIntroduction"},{default:r(()=>[l(U,{clearable:"",placeholder:"简介",type:"textarea",rows:3,maxlength:80,resize:"none","show-word-limit":"",modelValue:o.value.personIntroduction,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.personIntroduction=u)},null,8,["modelValue"])]),_:1}),l(i,{label:"公告",prop:"noticeInfo"},{default:r(()=>[l(U,{clearable:"",placeholder:"公告",type:"textarea",rows:5,maxlength:300,resize:"none","show-word-limit":"",modelValue:o.value.noticeInfo,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.noticeInfo=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])}}},de={class:"user-home-body"},ce={class:"user-info-panel"},me={class:"avatar"},ve={class:"user-info"},pe={class:"user-name"},fe={class:"introduction"},_e={key:0,class:"focus-panel"},he={class:"home-nav"},ge={class:"nav-panel"},ye={class:"search"},Ie={class:"count-info"},we={class:"count-value"},be={key:1,class:"count-item"},xe={class:"count-value"},ke={class:"count-value"},Ve={key:3,class:"count-item"},Ce={class:"count-value"},Ue={class:"count-item"},Ne={class:"count-value"},$e={class:"count-item"},Le={class:"count-value"},Re={class:"user-home-content"},Te={__name:"UserHomeLayout",setup(A){const{proxy:m}=q(),V=E(),I=S(),n=K(),o=V.params.userId,C=y([{name:"主页",path:"/user/"+o,icon:"icon-home",pathNames:["uhome","uhomeFans","uhomeFocus"]},{name:"投稿",path:"/user/"+o+"/video",icon:"icon-play",pathNames:["uhomeMyVideo"]},{name:"视频列表",path:"/user/"+o+"/series",icon:"icon-playlist",pathNames:["uhomeSeries","uhomeSeriesDetail"]},{name:"收藏",path:"/user/"+o+"/collection",icon:"icon-collection",pathNames:["collection"]}]),b=Q(()=>n.userInfo.userId==o),a=y({});T("userInfo",a);const _=async()=>{let d=await m.Request({url:m.Api.uHomeGetUsesrInfo,params:{userId:o}});if(!d)return;a.value=d.data;let e=d.data.noticeInfo;e&&(e=e.replace(/\r\n/g,"<br>"),e=e.replace(/\n/g,"<br>"),a.value.noticeInfo=e),n.isLoggedIn&&n.userInfo.userId===o&&n.userInfo.avatar!==d.data.avatar&&(n.userInfo.avatar=d.data.avatar)};_();const x=y(),h=()=>{x.value.show(a.value)},t=async(d,e=0,u)=>{if(!n.isLoggedIn){n.setLogin(!0);return}await m.Request({url:m.Api.uHomeFocus,showLoading:!0,params:{focusUserId:d}})&&(e==0?(a.value.haveFocus=!0,a.value.fansCount++):a.value.focusCount++,u&&u())},i=async(d,e=0,u)=>{await m.Request({url:m.Api.uHomeCancelFocus,showLoading:!0,params:{focusUserId:d}})&&(e==0?(a.value.haveFocus=!1,a.value.fansCount--):a.value.focusCount--,u&&u())};T("cancelFocusUser",(d,e)=>{i(d,1,e)}),T("focusUser",(d,e)=>{t(d,1,e)});const w=y(),U=()=>{I.push({path:`/user/${V.params.userId}/video`,query:{videoName:w.value}})},N=y(),D=()=>{N.value.show(a.value.theme)},H=d=>{a.value.theme=d};return(d,e)=>{const u=v("Avatar"),$=v("router-link"),O=v("el-input"),j=v("router-view");return c(),f(M,null,[s("div",{class:"header-fixed",style:z({"max-width":p(m).bodyMaxWidth+"px","min-width":p(m).bodyMinWidth+"px"})},[l(ee,{theme:"dark"})],4),s("div",{class:"user-home-body-container",style:z({"max-width":p(m).bodyMaxWidth+"px","min-width":p(m).bodyMinWidth+"px","background-image":`url(${p(m).Utils.getLocalImage("uhome-bg/"+(a.value.theme||0)+".png")})`})},[s("div",de,[s("div",ce,[s("div",me,[l(u,{width:90,avatar:a.value.avatar,userId:a.value.userId},null,8,["avatar","userId"])]),s("div",ve,[s("div",pe,[s("div",null,g(a.value.nickName),1),a.value.sex==0||a.value.sex==1?(c(),f("div",{key:0,class:W(["iconfont",a.value.sex==0?"icon-sexw":"icon-sexm"])},null,2)):L("",!0),b.value?(c(),f("div",{key:1,class:"iconfont icon-edit",onClick:h})):L("",!0)]),s("div",fe,g(a.value.personIntroduction),1)]),b.value?L("",!0):(c(),f("div",_e,[a.value.haveFocus?(c(),f("div",{key:0,class:"btn-focus btn-cancel-focus",onClick:e[0]||(e[0]=k=>i(p(o)))}," 取消关注 ")):(c(),f("div",{key:1,class:"btn-focus",onClick:e[1]||(e[1]=k=>t(p(o)))}," 关注 "))]))]),s("div",he,[s("div",ge,[(c(!0),f(M,null,B(C.value,k=>(c(),F($,{class:W(["nav-item iconfont",k.icon,k.pathNames.includes(p(V).name)?"active":""]),to:k.path},{default:r(()=>[R(g(k.name),1)]),_:2},1032,["class","to"]))),256))]),s("div",ye,[l(O,{placeholder:"搜视频",style:{width:"200px"},modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=k=>w.value=k),onKeyup:J(U,["enter"])},{suffix:r(()=>e[3]||(e[3]=[s("span",{class:"iconfont icon-search"},null,-1)])),_:1},8,["modelValue"])]),s("div",Ie,[b.value?(c(),F($,{key:0,class:"count-item",to:`/user/${p(o)}/focus`},{default:r(()=>[e[4]||(e[4]=s("div",{class:"title-info"},"关注数",-1)),s("div",we,g(a.value.focusCount),1)]),_:1,__:[4]},8,["to"])):(c(),f("div",be,[e[5]||(e[5]=s("div",{class:"title-info"},"关注数",-1)),s("div",xe,g(a.value.focusCount),1)])),b.value?(c(),F($,{key:2,class:"count-item",to:`/user/${p(o)}/fans`},{default:r(()=>[e[6]||(e[6]=s("div",{class:"title-info"},"粉丝数",-1)),s("div",ke,g(a.value.fansCount),1)]),_:1,__:[6]},8,["to"])):(c(),f("div",Ve,[e[7]||(e[7]=s("div",{class:"title-info"},"粉丝数",-1)),s("div",Ce,g(a.value.fansCount),1)])),s("div",Ue,[e[8]||(e[8]=s("div",{class:"title-info"},"获赞数",-1)),s("div",Ne,g(a.value.likeCount),1)]),s("div",$e,[e[9]||(e[9]=s("div",{class:"title-info"},"播放数",-1)),s("div",Le,g(a.value.playCount),1)])])]),s("div",Re,[l(j)])]),p(n).userInfo&&a.value.userId==p(n).userInfo.userId?(c(),f("div",{key:0,class:"change-them-btn",onClick:D})):L("",!0)],4),l(Z),l(ie,{ref_key:"userInfoEditRef",ref:x,onReload:_},null,512),l(re,{ref_key:"userHomeThemeRef",ref:N,onChangeTheme:H},null,512)],64)}}},lo=Y(Te,[["__scopeId","data-v-0674cd86"]]);export{lo as default};
