import{f as U,r as p,i as A,h as B,al as v,c as f,o as m,Q as a,I as s,a as t,D as L,H as I,K as y,a4 as b,T as M,u as T,n as S}from"./@vue-_Q8M3GyZ.js";import{m as $}from"./js-md5-Bbdx8amY.js";import{a as E}from"./index-V73uJnXy.js";const F={class:"dialog-panel"},H={class:"tab-panel"},O={key:0,class:"register-form"},Q={class:"check-code-panel"},j=["title"],G=["src"],J={key:1,class:"check-code-loading"},W={key:0},X={key:1},oe={__name:"Account",setup(Y){const{proxy:u}=U(),d=E(),g=p({}),w=p(!1),k=async()=>{w.value=!0;try{const i=await u.Request({url:u.Api.checkCode});i&&(g.value=i.data)}finally{w.value=!1}},x=p({show:!0}),R=(i,e,n)=>{e!==o.value.registerPassword?n(new Error(i.message)):n()},r=p(1),o=p({}),C=p(),h=p(!1),q={email:[{required:!0,message:"请输入邮箱"},{validator:u.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:u.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:R,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},P=()=>{k(),S(()=>{C.value.resetFields(),o.value={}})},_=()=>{C.value.validate(async i=>{if(i){h.value=!0;try{const e={...o.value,checkCodeKey:g.value.checkCodeKey};r.value===1&&(e.password=$(e.password));const n=await u.Request({url:r.value===0?u.Api.register:u.Api.login,params:e,errorCallback:()=>{k()}});if(!n)return;r.value===0?(u.Message.success("注册成功,请登录"),V(1)):r.value===1&&(u.Message.success("登录成功"),d.setLogin(!1),d.saveUserInfo(n.data))}finally{h.value=!1}}})},z=()=>{x.value.show=!1,d.setLogin(!1)},V=i=>{r.value=i,d.showLogin&&P()};return A(()=>d.showLogin,i=>{i&&(r.value=1,P())},{immediate:!0}),B(()=>{d.showLogin&&k()}),(i,e)=>{const n=v("el-input"),c=v("el-form-item"),D=v("el-button"),K=v("el-form"),N=v("Dialog");return m(),f("div",null,[a(N,{show:T(d).showLogin,buttons:x.value.buttons,width:"420px",showCancel:!1,onClose:z,padding:0,draggable:!0,top:100,closeOnClickModal:!0},{default:s(()=>[t("div",F,[t("div",H,[t("div",{class:L(["tab-item",r.value===1?"active":""]),onClick:e[0]||(e[0]=l=>V(1))}," 登录 ",2),t("div",{class:L(["tab-item",r.value===0?"active":""]),onClick:e[1]||(e[1]=l=>V(0))}," 注册 ",2)]),a(K,{class:"login-register",model:o.value,rules:q,ref_key:"formDataRef",ref:C},{default:s(()=>[a(c,{prop:"email"},{default:s(()=>[a(n,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:o.value.email,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.email=l),maxLength:"150",onKeyup:b(_,["enter"])},{prefix:s(()=>e[9]||(e[9]=[t("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),r.value===1?(m(),I(c,{key:0,prop:"password"},{default:s(()=>[a(n,{"show-password":"",size:"large",placeholder:"请输入密码",modelValue:o.value.password,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.password=l),onKeyup:b(_,["enter"])},{prefix:s(()=>e[10]||(e[10]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})):y("",!0),a(M,{name:"fade"},{default:s(()=>[r.value===0?(m(),f("div",O,[a(c,{prop:"nickName"},{default:s(()=>[a(n,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:o.value.nickName,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.nickName=l),maxLength:"20"},{prefix:s(()=>e[11]||(e[11]=[t("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(c,{prop:"registerPassword"},{default:s(()=>[a(n,{"show-password":"",type:"password",size:"large",placeholder:"请输入密码",modelValue:o.value.registerPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.registerPassword=l)},{prefix:s(()=>e[12]||(e[12]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(c,{prop:"reRegisterPassword"},{default:s(()=>[a(n,{"show-password":"",type:"password",size:"large",placeholder:"请再次输入密码",modelValue:o.value.reRegisterPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.reRegisterPassword=l)},{prefix:s(()=>e[13]||(e[13]=[t("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})])):y("",!0)]),_:1}),a(c,{prop:"checkCode"},{default:s(()=>[t("div",Q,[a(n,{size:"large",placeholder:"请输入验证码",modelValue:o.value.checkCode,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.checkCode=l),onKeyup:b(_,["enter"])},{prefix:s(()=>e[14]||(e[14]=[t("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),t("div",{class:"check-code-wrapper",onClick:e[8]||(e[8]=l=>k()),title:w.value?"加载中...":"点击刷新验证码"},[g.value.checkCode&&!w.value?(m(),f("img",{key:0,src:g.value.checkCode,class:"check-code",alt:"验证码"},null,8,G)):(m(),f("div",J,e[15]||(e[15]=[t("span",{class:"iconfont icon-loading"},null,-1)])))],8,j)])]),_:1}),a(c,{class:"bottom-btn"},{default:s(()=>[a(D,{type:"primary",size:"large",class:"login-btn",loading:h.value,onClick:_},{default:s(()=>[r.value===0?(m(),f("span",W,"注册")):y("",!0),r.value===1?(m(),f("span",X,"登录")):y("",!0)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["show","buttons"])])}}};export{oe as _};
