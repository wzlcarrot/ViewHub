import{a as S,u as L}from"./vue-router-ffDWPyKt.js";import{_ as N,a as w}from"./index-V73uJnXy.js";import{f as A,al as y,c as i,o as a,a as t,K as _,D as I,O as r,Q as v,I as T,M,u as R,P as b,r as x,h as E,a6 as q,H as U}from"./@vue-_Q8M3GyZ.js";import"./pinia-CtRA5Bu2.js";import"./element-plus-Bescc1QT.js";import"./lodash-es-S0Y0Up6J.js";import"./@vueuse-DfuMZOfy.js";import"./@element-plus-B8yk6LGT.js";import"./@popperjs-D_chPuIy.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-BdefatKI.js";import"./artplayer-BnYtXt6g.js";import"./async-validator-9PlIezaS.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-85_40PfK.js";import"./axios-NIGUFBhG.js";import"./vue-cookies-B4eaU0RH.js";import"./@fingerprintjs-BciRmnos.js";import"./tslib-BLN2B0TR.js";import"./vue-cropper-BrUi_TYK.js";import"./mitt-DJ65BbbF.js";import"./moment-C5S46NFB.js";const B={class:"message-item"},G={class:"sys-info"},V={key:0,class:"resean"},O={key:1,class:"success"},j={class:"send-time"},P={class:"video-cover"},z={__name:"MessageSys",props:{data:{type:Object,default:{}}},emits:["delMessage"],setup(e,{emit:o}){const{proxy:f}=A();S();const c=o,C=u=>{c("delMessage",u)};return(u,l)=>{const p=y("router-link"),m=y("Cover");return a(),i("div",B,[t("div",G,[t("div",{class:I(["video-name iconfont",e.data.extendDto.auditStatus==3?"icon-success":"icon-error"])}," 视频 【"+r(e.data.videoName)+"】审核 "+r(e.data.extendDto.auditStatus==3?"成功":"失败"),3),e.data.extendDto.auditStatus!=3?(a(),i("div",V," 失败原因："+r(e.data.extendDto.messageContent),1)):_("",!0),e.data.extendDto.auditStatus==3?(a(),i("div",O,[v(p,{class:"a-link",to:`/video/${e.data.videoId}`,target:"_blank"},{default:T(()=>l[1]||(l[1]=[M("点击查看",-1)])),_:1,__:[1]},8,["to"])])):_("",!0),t("div",j,[M(r(R(f).Utils.formatDate(e.data.createTime))+" ",1),t("span",{class:"iconfont icon-delete",onClick:l[0]||(l[0]=g=>C(e.data.messageId))})])]),t("div",P,[v(p,{to:`/video/${e.data.videoId}`,target:"_blank"},{default:T(()=>[v(m,{source:e.data.videoCover},null,8,["source"])]),_:1},8,["to"])])])}}},F=N(z,[["__scopeId","data-v-358e6b02"]]),H={class:"message-item"},K={class:"user-info-panel"},Q={class:"user-info"},Y={class:"title-info"},J={class:"comment"},W={key:0,class:"reply"},X={class:"send-time"},Z={class:"video-cover"},ee={__name:"MessageItem",props:{data:{type:Object,default:{}}},emits:["delMessage"],setup(e,{emit:o}){const{proxy:f}=A();S();const c=e,C={1:"系统消息",2:"点赞",3:"收藏",4:"评论"},u=()=>c.data.messageType==4?c.data.extendDto.messageContentReply?"在视频中回复了你的评论":"在视频中发表了评论":`${C[c.data.messageType]}了视频`,l=o,p=m=>{l("delMessage",m)};return(m,g)=>{const k=y("Avatar"),h=y("router-link"),D=y("Cover");return a(),i("div",H,[v(k,{avatar:e.data.sendUserAvatar,userId:e.data.sendUserId},null,8,["avatar","userId"]),t("div",K,[t("div",Q,[v(h,{to:`/user/${e.data.sendUserId}`,class:"user-name",target:"_blank"},{default:T(()=>[M(r(e.data.sendUserName),1)]),_:1},8,["to"]),t("span",Y,r(u()),1)]),e.data.messageType==4?(a(),i(b,{key:0},[t("div",J,r(e.data.extendDto.messageContent),1),e.data.extendDto.messageContentReply?(a(),i("div",W,r(e.data.extendDto.messageContentReply),1)):_("",!0)],64)):_("",!0),t("div",X,[M(r(R(f).Utils.formatDate(e.data.createTime))+" ",1),t("span",{class:"iconfont icon-delete",onClick:g[0]||(g[0]=s=>p(e.data.messageId))})])]),t("div",Z,[v(h,{to:`/video/${e.data.videoId}`,target:"_blank"},{default:T(()=>[v(D,{source:e.data.videoCover},null,8,["source"])]),_:1},8,["to"])])])}}},se=N(ee,[["__scopeId","data-v-1b2e59f8"]]),te={class:"message-panel"},ae={class:"left-panel"},oe=["onClick"],ne={key:0,class:"message-count"},de={class:"right-panel"},ie={key:0,class:"home"},re={key:1,class:"message-list"},ce={__name:"UserMessage",setup(e){const{proxy:o}=A(),f=S(),c=L(),C=w(),u=x([{name:"系统通知",messageTypeCode:"sys",messageType:1,noReadCount:0,icon:"icon-sys-message"},{name:"收到的赞",messageTypeCode:"like",messageType:2,noReadCount:0,icon:"icon-good"},{name:"收到收藏",messageTypeCode:"collection",messageType:3,noReadCount:0,icon:"icon-collection"},{name:"评论和@",messageTypeCode:"comment",messageType:4,noReadCount:0,icon:"icon-comment"}]),l=x({}),p=s=>{D(s),C.readMessageCount(s.noReadCount),l.value=s,f.push(`/message/${s.messageTypeCode}`),g()},m=x({}),g=async()=>{let s={pageNo:m.value.pageNo,messageType:l.value.messageType},d=await o.Request({url:o.Api.loadUserMessage,params:s});d&&(m.value=d.data)},k=s=>{o.Confirm({message:"确定要删除消息吗？",okfun:async()=>{await o.Request({url:o.Api.delMessage,params:{messageId:s}})&&g()}})};(async()=>{let s=await o.Request({url:o.Api.getNoReadCountGroup});s&&u.value.forEach(d=>{const $=s.data.find(n=>n.messageType==d.messageType);$&&(d.noReadCount=$.messageCount)})})();const D=async s=>{s.noReadCount==0||!await o.Request({url:o.Api.readAll,params:{messageType:s.messageType}})||(s.noReadCount=0)};return E(()=>{c.params.messageType&&(l.value=u.value.find(s=>s.messageTypeCode==c.params.messageType),g())}),(s,d)=>{const $=y("DataList");return a(),i("div",te,[t("div",ae,[d[0]||(d[0]=t("div",{class:"message-title"},"消息中心",-1)),(a(!0),i(b,null,q(u.value,n=>(a(),i("div",{class:I(["message-part",R(c).params.messageType==n.messageTypeCode?"active":""]),onClick:le=>p(n)},[t("div",{class:I(["iconfont",n.icon])},r(n.name),3),n.noReadCount>0?(a(),i("div",ne,r(n.noReadCount>99?"99+":n.noReadCount),1)):_("",!0)],10,oe))),256))]),t("div",de,[R(c).params.messageType?(a(),i("div",re,[v($,{dataSource:m.value,onLoadData:g},{default:T(({data:n})=>[n.messageType==1?(a(),U(F,{key:0,data:n,onDelMessage:k},null,8,["data"])):(a(),U(se,{key:1,data:n,onDelMessage:k},null,8,["data"]))]),_:1},8,["dataSource"])])):(a(),i("div",ie,d[1]||(d[1]=[t("div",{class:"iconfont icon-message"},null,-1)])))])])}}},Le=N(ce,[["__scopeId","data-v-40617df1"]]);export{Le as default};
